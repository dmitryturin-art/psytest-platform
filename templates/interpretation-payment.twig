{% extends "layout.twig" %}

{% block title %}AI-–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è - {{ appName }}{% endblock %}

{% block body_class %}interpretation-page{% endblock %}

{% block content %}
<div class="interpretation-wrapper">
    <div class="interpretation-header">
        <h1>–†–∞–∑–≤—ë—Ä–Ω—É—Ç–∞—è AI-–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è</h1>
        <p class="subtitle">{{ test.name }}</p>
    </div>
    
    {% if interpretation.payment_status == 'completed' %}
    <!-- Interpretation ready -->
    <div class="interpretation-content">
        <div class="interpretation-text">
            {{ interpretation.interpretation_text|raw }}
        </div>
        
        <div class="interpretation-actions">
            <a href="{{ basePath }}{{ interpretation.pdf_path }}" 
               class="btn btn-primary" target="_blank">
                üìÑ –°–∫–∞—á–∞—Ç—å PDF
            </a>
            <button class="btn btn-secondary" onclick="window.print()">
                üñ®Ô∏è –ü–µ—á–∞—Ç—å
            </button>
        </div>
    </div>
    
    {% else %}
    <!-- Payment required -->
    <div class="payment-required">
        <div class="payment-info">
            <h2>–ü–æ–ª—É—á–∏—Ç—å —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—É—é –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é</h2>
            <p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è AI-–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç:</p>
            <ul>
                <li>–ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ñ–∏–ª—è –ª–∏—á–Ω–æ—Å—Ç–∏</li>
                <li>–û–ø–∏—Å–∞–Ω–∏–µ –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π</li>
                <li>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã</li>
                <li>PDF-–æ—Ç—á—ë—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è</li>
            </ul>
            
            <div class="price-block">
                <span class="price">{{ price }} ‚ÇΩ</span>
            </div>
            
            <form method="POST" action="{{ basePath }}/interpretation/{{ session.session_token }}/pay" 
                  class="payment-form">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                
                <div class="form-group">
                    <label for="email">–í–∞—à Email (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á—ë—Ç–∞):</label>
                    <input type="email" id="email" name="email" required 
                           value="{{ session.user_email }}"
                           placeholder="example@mail.ru">
                </div>
                
                <button type="submit" class="btn btn-primary btn-lg btn-block">
                    üí≥ –û–ø–ª–∞—Ç–∏—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é
                </button>
                
                <p class="payment-note">
                    üîí –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –ÆMoney
                </p>
            </form>
        </div>
        
        <div class="disclaimer-box">
            <p><strong>–í–∞–∂–Ω–æ:</strong> AI-–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –Ω–æ—Å–∏—Ç –æ–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä 
            –∏ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –æ—á–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞.</p>
        </div>
    </div>
    {% endif %}
</div>

<style>
.interpretation-wrapper {
    max-width: 800px;
    margin: 0 auto;
}

.interpretation-header {
    text-align: center;
    margin-bottom: var(--spacing-xl);
}

.interpretation-content {
    background: var(--color-bg-white);
    padding: var(--spacing-xl);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
}

.interpretation-text {
    line-height: 1.8;
    margin-bottom: var(--spacing-xl);
}

.interpretation-actions {
    display: flex;
    gap: var(--spacing-md);
    justify-content: center;
    padding-top: var(--spacing-lg);
    border-top: 1px solid var(--color-border);
}

.payment-required {
    background: var(--color-bg-white);
    padding: var(--spacing-xl);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
}

.payment-info h2 {
    margin-bottom: var(--spacing-md);
}

.payment-info ul {
    margin: var(--spacing-lg) 0;
    padding-left: var(--spacing-lg);
}

.payment-info li {
    margin-bottom: var(--spacing-sm);
}

.price-block {
    text-align: center;
    margin: var(--spacing-xl) 0;
}

.price {
    font-size: 3rem;
    font-weight: 700;
    color: var(--color-primary);
}

.payment-form {
    margin-top: var(--spacing-xl);
}

.form-group {
    margin-bottom: var(--spacing-lg);
}

.form-group label {
    display: block;
    margin-bottom: var(--spacing-sm);
    font-weight: 500;
}

.form-group input {
    width: 100%;
    padding: var(--spacing-sm) var(--spacing-md);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    font-size: var(--font-size-base);
}

.btn-lg {
    padding: var(--spacing-md) var(--spacing-xl);
    font-size: var(--font-size-lg);
}

.payment-note {
    text-align: center;
    margin-top: var(--spacing-md);
    color: var(--color-text-light);
    font-size: var(--font-size-sm);
}

.disclaimer-box {
    margin-top: var(--spacing-xl);
    padding: var(--spacing-md);
    background: #fff3cd;
    border: 1px solid #ffc107;
    border-radius: var(--radius-md);
    font-size: var(--font-size-sm);
}
</style>
{% endblock %}
