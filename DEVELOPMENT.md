# PsyTest Platform - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –ò–ò

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#–æ–±–∑–æ—Ä-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
2. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
3. [–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç](#–∫–∞–∫-—ç—Ç–æ-—Ä–∞–±–æ—Ç–∞–µ—Ç)
4. [–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞](#—Å–æ–∑–¥–∞–Ω–∏–µ-–Ω–æ–≤–æ–≥–æ-—Ç–µ—Å—Ç–∞)
5. [API Reference](#api-reference)
6. [–ü—Ä–∞–≤–∏–ª–∞ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ò–ò](#–ø—Ä–∞–≤–∏–ª–∞-–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è-–¥–ª—è-–∏–∏)
7. [–ß–∞—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏ –∏ —Ä–µ—à–µ–Ω–∏—è](#—á–∞—Å—Ç—ã–µ-–∑–∞–¥–∞—á–∏-–∏-—Ä–µ—à–µ–Ω–∏—è)

---

## üèóÔ∏è –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –¢–∏–ø –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
**–ú–æ–¥—É–ª—å–Ω–∞—è MVC-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞:
- **–Ø–¥—Ä–æ (Core)** - –±–∞–∑–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **–ú–æ–¥—É–ª–∏ —Ç–µ—Å—Ç–æ–≤** - –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –º–µ—Ç–æ–¥–∏–∫–∏
- **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
- **–°–µ—Ä–≤–∏—Å—ã** - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–ø–ª–∞—Ç–µ–∂–∏, AI, email)
- **–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ (Views)** - Twig —à–∞–±–ª–æ–Ω—ã

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    PUBLIC (Web Root)                     ‚îÇ
‚îÇ  index.php ‚Üí Router ‚Üí Controllers ‚Üí Services ‚Üí Database  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     MODULES (Tests)                      ‚îÇ
‚îÇ  TestModuleInterface ‚Üê BaseTestModule ‚Üê ConcreteModule   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
User Request
    ‚Üì
public/index.php (Entry Point)
    ‚Üì
Router (–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è)
    ‚Üì
Controller (–û–±—Ä–∞–±–æ—Ç–∫–∞)
    ‚Üì
ModuleLoader ‚Üí TestModule (–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ç–µ—Å—Ç–∞)
    ‚Üì
SessionManager (–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏)
    ‚Üì
Database (–•—Ä–∞–Ω–µ–Ω–∏–µ)
    ‚Üì
View (–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ Twig)
    ‚Üì
HTML Response
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
hyptest/
‚îú‚îÄ‚îÄ üìÇ bin/                    # CLI —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ install-db.php         # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ cleanup-sessions.php   # –û—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–π (cron)
‚îÇ
‚îú‚îÄ‚îÄ üìÇ config/                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ config.php             # –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ + .env loader
‚îÇ
‚îú‚îÄ‚îÄ üìÇ core/                   # –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã (–ù–ï –ú–ï–ù–Ø–¢–¨ –ë–ï–ó –ù–£–ñ–î–´)
‚îÇ   ‚îú‚îÄ‚îÄ Database.php           # PDO wrapper, singleton
‚îÇ   ‚îú‚îÄ‚îÄ Router.php             # –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ SessionManager.php     # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ ModuleLoader.php       # –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π —Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ PDFGenerator.php       # DomPDF –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ View.php               # Twig —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
‚îÇ   ‚îú‚îÄ‚îÄ Security.php           # Security helpers
‚îÇ   ‚îî‚îÄ‚îÄ LoggerFactory.php      # Monolog –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ
‚îú‚îÄ‚îÄ üìÇ controllers/            # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ HomeController.php     # –ì–ª–∞–≤–Ω–∞—è, —Å–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ TestController.php     # –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ ResultController.php   # –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ ApiController.php      # API, webhooks
‚îÇ
‚îú‚îÄ‚îÄ üìÇ modules/                # –ú–æ–¥—É–ª–∏ —Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ TestModuleInterface.php    # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ BaseTestModule.php         # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å
‚îÇ   ‚îî‚îÄ‚îÄ {test-name}/               # –ü–∞–ø–∫–∞ —Ç–µ—Å—Ç–∞
‚îÇ       ‚îú‚îÄ‚îÄ {TestName}Module.php   # –ö–ª–∞—Å—Å –º–æ–¥—É–ª—è
‚îÇ       ‚îú‚îÄ‚îÄ metadata.json          # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç–∞
‚îÇ       ‚îî‚îÄ‚îÄ questions.json         # –í–æ–ø—Ä–æ—Å—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îÇ
‚îú‚îÄ‚îÄ üìÇ services/               # –°–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ PaymentService.php         # –ÆMoney –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ AIInterpretationService.php # OpenRouter AI
‚îÇ   ‚îî‚îÄ‚îÄ EmailService.php           # Email —Ä–∞—Å—Å—ã–ª–∫–∞
‚îÇ
‚îú‚îÄ‚îÄ üìÇ templates/              # Twig —à–∞–±–ª–æ–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ layout.twig            # –ë–∞–∑–æ–≤—ã–π –º–∞–∫–µ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ test-wrapper.twig      # –û–±–æ–ª–æ—á–∫–∞ —Ç–µ—Å—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ result-page.twig       # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ tests-list.twig        # –°–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ üìÇ public/                 # –ü—É–±–ª–∏—á–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è (web root)
‚îÇ   ‚îú‚îÄ‚îÄ index.php              # Entry point
‚îÇ   ‚îú‚îÄ‚îÄ demo.php               # –î–µ–º–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.css           # –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.js            # –û–±—â–∏–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test-taking.js     # –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ results.js         # –ì—Ä–∞—Ñ–∏–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ uploads/               # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ
‚îú‚îÄ‚îÄ üìÇ database/               # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ schema.sql             # SQL —Å—Ö–µ–º–∞
‚îÇ
‚îú‚îÄ‚îÄ üìÇ storage/                # –•—Ä–∞–Ω–∏–ª–∏—â–µ (–≤–Ω–µ web-root)
‚îÇ   ‚îú‚îÄ‚îÄ pdfs/                  # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ PDF
‚îÇ   ‚îú‚îÄ‚îÄ logs/                  # –õ–æ–≥–∏
‚îÇ   ‚îî‚îÄ‚îÄ cache/                 # Twig –∫—ç—à
‚îÇ
‚îú‚îÄ‚îÄ composer.json              # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ PHP
‚îú‚îÄ‚îÄ .env                       # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ .env.example               # –ü—Ä–∏–º–µ—Ä .env
```

---

## ‚öôÔ∏è –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–§–∞–π–ª:** `public/index.php`

```php
// 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
$configLoader = require __DIR__ . '/../config.php';

// 2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ autoload
require_once __DIR__ . '/../vendor/autoload.php';

// 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–¥—Ä–∞
$db = Database::getInstance();
$router = new Router();
$moduleLoader = (new ModuleLoader(null, $db))->discover();
$sessionManager = new SessionManager($db);

// 4. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
$router->get('/tests', [HomeController::class, 'tests']);
$router->get('/test/{slug}', [TestController::class, 'start']);
// ...

// 5. Dispatch
$response = $router->dispatch();
```

### 2. –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è

**–§–∞–π–ª:** `core/Router.php`

```php
// –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–µ—Ç–æ–¥—ã
$router->get('/path', $handler);
$router->post('/path', $handler);
$router->put('/path', $handler);
$router->delete('/path', $handler);

// –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ URL
$router->get('/test/{slug}', $handler);
// {slug} –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ handler –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç
```

### 3. –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π —Ç–µ—Å—Ç–æ–≤

**–§–∞–π–ª:** `core/ModuleLoader.php`

```php
// discover() —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –ø–∞–ø–∫—É modules/
// –î–ª—è –∫–∞–∂–¥–æ–π –ø–æ–¥–ø–∞–ø–∫–∏:
// 1. –ò—â–µ—Ç {Name}Module.php
// 2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é TestModuleInterface
// 3. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –º–æ–¥—É–ª—å

$moduleLoader = new ModuleLoader(null, $db);
$moduleLoader->discover();

// –ü–æ–ª—É—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è
$module = $moduleLoader->getModule('smil');
$metadata = $module->getMetadata();
```

### 4. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Ç–µ—Å—Ç–∞

```
1. GET /test/smil
   ‚Üì
   TestController->start('smil')
   ‚Üì
   SessionManager->createSession($testId)
   ‚Üì
   Render test-wrapper.twig —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏

2. POST /test/smil/submit
   ‚Üì
   TestController->submit('smil')
   ‚Üì
   SessionManager->getSessionById($id)
   ‚Üì
   SmilModule->calculateResults($answers)
   ‚Üì
   SmilModule->generateInterpretation($scores)
   ‚Üì
   SessionManager->completeSession($id, $results)
   ‚Üì
   Redirect /result/smil/{token}

3. GET /result/smil/{token}
   ‚Üì
   ResultController->show('smil', $token)
   ‚Üì
   SessionManager->getSessionByToken($token)
   ‚Üì
   SmilModule->renderResults($results)
   ‚Üì
   Render result-page.twig
```

---

## üß© –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞

### –®–∞–≥ 1: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫

–°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–∞ –≤ `modules/`:

```
modules/beck-depression/
‚îú‚îÄ‚îÄ BeckDepressionModule.php   # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å
‚îú‚îÄ‚îÄ metadata.json              # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
‚îî‚îÄ‚îÄ questions.json             # –í–æ–ø—Ä–æ—Å—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

### –®–∞–≥ 2: –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (metadata.json)

```json
{
  "slug": "beck-depression",
  "name": "–û–ø—Ä–æ—Å–Ω–∏–∫ –ë–µ–∫–∞ (BDI)",
  "description": "–®–∫–∞–ª–∞ –¥–µ–ø—Ä–µ—Å—Å–∏–∏ –ë–µ–∫–∞ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —É—Ä–æ–≤–Ω—è –¥–µ–ø—Ä–µ—Å—Å–∏–∏",
  "question_count": 21,
  "estimated_time": 5,
  "scales": [
    {"code": "BDI", "name": "–û–±—â–∏–π –±–∞–ª–ª", "description": "–°—É–º–º–∞—Ä–Ω—ã–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å"}
  ],
  "version": "1.0",
  "author": "Aaron T. Beck"
}
```

### –®–∞–≥ 3: –í–æ–ø—Ä–æ—Å—ã (questions.json)

```json
[
  {
    "id": 1,
    "text": "–ö–∞–∫ –≤—ã –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç–µ —Å–≤–æ—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ?",
    "options": [
      {"value": 0, "text": "–Ø –Ω–µ —á—É–≤—Å—Ç–≤—É—é –≥—Ä—É—Å—Ç–∏"},
      {"value": 1, "text": "–Ø —á—É–≤—Å—Ç–≤—É—é –≥—Ä—É—Å—Ç—å"},
      {"value": 2, "text": "–Ø –≤—Å—ë –≤—Ä–µ–º—è –≥—Ä—É—â—É"},
      {"value": 3, "text": "–Ø –æ—á–µ–Ω—å –Ω–µ—Å—á–∞—Å—Ç–µ–Ω"}
    ],
    "scale": "BDI"
  },
  {
    "id": 2,
    "text": "–ö–∞–∫ –≤—ã —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ –±—É–¥—É—â–µ–µ?",
    "options": [
      {"value": 0, "text": "–Ø –Ω–µ —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω"},
      {"value": 1, "text": "–Ø —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω"},
      {"value": 2, "text": "–Ø –Ω–µ –∂–¥—É –Ω–∏—á–µ–≥–æ —Ö–æ—Ä–æ—à–µ–≥–æ"},
      {"value": 3, "text": "–ë—É–¥—É—â–µ–µ –±–µ–∑–Ω–∞–¥—ë–∂–Ω–æ"}
    ],
    "scale": "BDI"
  }
]
```

### –®–∞–≥ 4: –ö–ª–∞—Å—Å –º–æ–¥—É–ª—è (BeckDepressionModule.php)

```php
<?php
/**
 * Beck Depression Inventory Module
 */

declare(strict_types=1);

namespace PsyTest\Modules\BeckDepression;

use PsyTest\Modules\BaseTestModule;

class BeckDepressionModule extends BaseTestModule
{
    /**
     * –ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏
     */
    protected const THRESHOLDS = [
        'minimal' => ['min' => 0, 'max' => 13],
        'mild' => ['min' => 14, 'max' => 19],
        'moderate' => ['min' => 20, 'max' => 28],
        'severe' => ['min' => 29, 'max' => 63],
    ];

    /**
     * –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è
     */
    protected const INTERPRETATIONS = [
        'minimal' => '–î–µ–ø—Ä–µ—Å—Å–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞',
        'mild' => '–õ—ë–≥–∫–∞—è –¥–µ–ø—Ä–µ—Å—Å–∏—è, –≤–æ–∑–º–æ–∂–Ω—ã –∫–æ–ª–µ–±–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è',
        'moderate' => '–£–º–µ—Ä–µ–Ω–Ω–∞—è –¥–µ–ø—Ä–µ—Å—Å–∏—è, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è',
        'severe' => '–í—ã—Ä–∞–∂–µ–Ω–Ω–∞—è –¥–µ–ø—Ä–µ—Å—Å–∏—è, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–º–æ—â—å',
    ];

    /**
     * {@inheritDoc}
     */
    public function getMetadata(): array
    {
        return array_merge(parent::getMetadata(), [
            'scoring_type' => 'sum', // sum, average, t-score
            'max_score' => 63,
        ]);
    }

    /**
     * {@inheritDoc}
     */
    public function getQuestions(): array
    {
        if ($this->questions === null) {
            $this->questions = $this->loadQuestionsFromJson('questions.json');
        }
        
        return $this->questions;
    }

    /**
     * {@inheritDoc}
     */
    public function calculateResults(array $answers): array
    {
        // –ü–æ–¥—Å—á—ë—Ç —Å—É–º–º—ã –±–∞–ª–ª–æ–≤
        $totalScore = 0;
        $scaleScores = [];
        
        foreach ($answers as $questionId => $answer) {
            // –ù–∞—Ö–æ–¥–∏–º –≤–æ–ø—Ä–æ—Å –∏ –µ–≥–æ –≤–µ—Å
            $question = $this->findQuestionById((int)$questionId);
            if ($question) {
                $points = $this->getPointsForAnswer($question, $answer);
                $totalScore += $points;
                
                // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —à–∫–∞–ª–∞–º
                $scale = $question['scale'] ?? 'total';
                $scaleScores[$scale] = ($scaleScores[$scale] ?? 0) + $points;
            }
        }
        
        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
        $level = $this->getLevel($totalScore);
        
        return [
            'total_score' => $totalScore,
            'scale_scores' => $scaleScores,
            'level' => $level,
            'max_score' => self::THRESHOLDS['severe']['max'],
            'answered_count' => count($answers),
        ];
    }

    /**
     * {@inheritDoc}
     */
    public function generateInterpretation(array $scores): array
    {
        $level = $scores['level'] ?? 'minimal';
        $totalScore = $scores['total_score'] ?? 0;
        
        return [
            'summary' => sprintf(
                '–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: %d –±–∞–ª–ª–æ–≤. %s',
                $totalScore,
                self::INTERPRETATIONS[$level] ?? '–¢—Ä–µ–±—É–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è'
            ),
            'level' => $level,
            'level_name' => $this->getLevelName($level),
            'recommendations' => $this->getRecommendations($level),
            'disclaimer' => '–†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–æ—Å–∏—Ç –æ–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä',
        ];
    }

    /**
     * {@inheritDoc}
     */
    public function renderResults(array $results): string
    {
        $totalScore = $results['total_score'] ?? 0;
        $level = $results['level'] ?? 'minimal';
        $maxScore = $results['max_score'] ?? 63;
        
        // –†–∞—Å—á—ë—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∞
        $percentage = round(($totalScore / $maxScore) * 100);
        
        $html = '<div class="beck-results">';
        
        // –ë–ª–æ–∫ —Å –æ–±—â–∏–º –±–∞–ª–ª–æ–º
        $html .= '<div class="score-block">';
        $html .= '<h3>–û–±—â–∏–π –±–∞–ª–ª</h3>';
        $html .= sprintf('<div class="score-value">%d –∏–∑ %d</div>', $totalScore, $maxScore);
        $html .= sprintf('<div class="score-percentage">%d%%</div>', $percentage);
        $html .= '</div>';
        
        // –í–∏–∑—É–∞–ª—å–Ω–∞—è —à–∫–∞–ª–∞
        $html .= '<div class="severity-scale">';
        $html .= '<div class="scale-segment minimal">0-13</div>';
        $html .= '<div class="scale-segment mild">14-19</div>';
        $html .= '<div class="scale-segment moderate">20-28</div>';
        $html .= '<div class="scale-segment severe">29-63</div>';
        $html .= sprintf('<div class="marker" style="left: %d%%"></div>', $percentage);
        $html .= '</div>';
        
        // –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è
        $html .= '<div class="interpretation">';
        $html .= '<h4>–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è</h4>';
        $html .= sprintf('<p>%s</p>', self::INTERPRETATIONS[$level] ?? '');
        $html .= '</div>';
        
        $html .= '</div>';
        
        return $html;
    }

    /**
     * {@inheritDoc}
     */
    public function supportsPairMode(): bool
    {
        return false; // BDI –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ä–Ω—ã–π —Ä–µ–∂–∏–º
    }
    
    // ============================================
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
    // ============================================
    
    /**
     * –ù–∞–π—Ç–∏ –≤–æ–ø—Ä–æ—Å –ø–æ ID
     */
    protected function findQuestionById(int $id): ?array
    {
        $questions = $this->getQuestions();
        foreach ($questions as $question) {
            if ($question['id'] === $id) {
                return $question;
            }
        }
        return null;
    }
    
    /**
     * –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–ª—ã –∑–∞ –æ—Ç–≤–µ—Ç
     */
    protected function getPointsForAnswer(array $question, mixed $answer): int
    {
        if (!isset($question['options'])) {
            return 0;
        }
        
        foreach ($question['options'] as $option) {
            if ($option['value'] == $answer || $option['text'] == $answer) {
                return (int) $option['value'];
            }
        }
        
        return 0;
    }
    
    /**
     * –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ø–æ –±–∞–ª–ª–∞–º
     */
    protected function getLevel(int $score): string
    {
        foreach (self::THRESHOLDS as $level => $range) {
            if ($score >= $range['min'] && $score <= $range['max']) {
                return $level;
            }
        }
        return 'minimal';
    }
    
    /**
     * –ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è
     */
    protected function getLevelName(string $level): string
    {
        $names = [
            'minimal' => '–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π',
            'mild' => '–õ—ë–≥–∫–∏–π',
            'moderate' => '–£–º–µ—Ä–µ–Ω–Ω—ã–π',
            'severe' => '–í—ã—Ä–∞–∂–µ–Ω–Ω—ã–π',
        ];
        return $Names[$level] ?? $level;
    }
    
    /**
     * –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É—Ä–æ–≤–Ω—é
     */
    protected function getRecommendations(string $level): array
    {
        $recommendations = [
            'minimal' => [
                '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –∑–¥–æ—Ä–æ–≤—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏',
                '–†–µ–≥—É–ª—è—Ä–Ω–æ –∑–∞–Ω–∏–º–∞–π—Ç–µ—Å—å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é',
            ],
            'mild' => [
                '–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∂–∏–º —Å–Ω–∞',
                '–ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ —Ç–µ—Ö–Ω–∏–∫–∏ —Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏',
                '–†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é —Å –ø—Å–∏—Ö–æ–ª–æ–≥–æ–º',
            ],
            'moderate' => [
                '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞',
                '–†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–∏—é',
                '–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è',
            ],
            'severe' => [
                '–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–º–æ—â—å',
                '–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –ø—Å–∏—Ö–∏–∞—Ç—Ä—É –∏–ª–∏ –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç—É',
                '–ù–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ –≤–∏–∑–∏—Ç –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É',
            ],
        ];
        
        return $recommendations[$level] ?? [];
    }
}
```

### –®–∞–≥ 5: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```sql
INSERT INTO tests (name, slug, module_class, description, is_active, sort_order) 
VALUES (
    '–û–ø—Ä–æ—Å–Ω–∏–∫ –ë–µ–∫–∞ (BDI)',
    'beck-depression',
    'PsyTest\\Modules\\BeckDepression\\BeckDepressionModule',
    '–®–∫–∞–ª–∞ –¥–µ–ø—Ä–µ—Å—Å–∏–∏ –ë–µ–∫–∞ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —É—Ä–æ–≤–Ω—è –¥–µ–ø—Ä–µ—Å—Å–∏–∏',
    1,
    2
);
```

–ò–ª–∏ —á–µ—Ä–µ–∑ CLI:

```bash
php bin/install-db.php  # –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Å—Ç –ë–î —Å —Ç–µ—Å—Ç–æ–º
```

### –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
php test-architecture.php

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥—É–ª—è
php -r "
require 'vendor/autoload.php';
\$module = new PsyTest\Modules\BeckDepression\BeckDepressionModule();
print_r(\$module->getMetadata());
"
```

---

## üìö API Reference

### Core Classes

#### Database
```php
// –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: core/Database.php
// Singleton, PDO wrapper

$db = Database::getInstance();

// SELECT
$rows = $db->select('SELECT * FROM table WHERE id = ?', [$id]);
$row = $db->selectOne('SELECT * FROM table WHERE id = ?', [$id]);

// INSERT
$id = $db->insert('table', ['column' => 'value']);

// UPDATE
$affected = $db->update('table', ['column' => 'new'], 'id = ?', [$id]);

// DELETE
$deleted = $db->delete('table', 'id = ?', [$id]);

// Transaction
$db->beginTransaction();
try {
    // ...
    $db->commit();
} catch (\Exception $e) {
    $db->rollback();
}
```

#### Router
```php
// –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: core/Router.php

$router = new Router();

// –ú–∞—Ä—à—Ä—É—Ç—ã
$router->get('/path', $handler);
$router->post('/path', $handler);
$router->get('/path/{param}', $handler); // {param} –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ handler

// Middleware
$router->middleware(function($method, $uri, &$params) {
    // ...
    return null; // continue
});

// Dispatch
$response = $router->dispatch();
```

#### SessionManager
```php
// –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: core/SessionManager.php

$sessionManager = new SessionManager($db);

// –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏
$session = $sessionManager->createSession($testId, [
    'email' => 'user@example.com',
    'ip_address' => '127.0.0.1',
]);

// –ü–æ–ª—É—á–µ–Ω–∏–µ
$session = $sessionManager->getSessionByToken($token);
$session = $sessionManager->getSessionById($id);

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
$sessionManager->saveAnswers($sessionId, $answers);

// –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
$sessionManager->completeSession($sessionId, $results);

// –£–¥–∞–ª–µ–Ω–∏–µ (GDPR)
$sessionManager->deleteSession($sessionId);
```

#### ModuleLoader
```php
// –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: core/ModuleLoader.php

$moduleLoader = new ModuleLoader(null, $db);
$moduleLoader->discover(); // –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å modules/

// –ü–æ–ª—É—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è
$module = $moduleLoader->getModule('smil');
$metadata = $moduleLoader->getModuleMetadata('smil');

// –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –º–æ–¥—É–ª–∏
$modules = $moduleLoader->getActiveModules();
```

#### View (Twig)
```php
// –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: core/View.php

$view = View::getInstance();

// –†–µ–Ω–¥–µ—Ä
$html = $view->render('template-name', [
    'variable' => 'value',
]);

// –°—Ä–∞–∑—É –≤—ã–≤–æ–¥
$view->display('template-name', $data);

// Shared variables
$view->share('key', 'value');
```

### TestModuleInterface

```php
// –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: modules/TestModuleInterface.php

interface TestModuleInterface
{
    public function getMetadata(): array;
    public function getQuestions(): array;
    public function calculateResults(array $answers): array;
    public function generateInterpretation(array $scores): array;
    public function renderResults(array $results): string;
    public function supportsPairMode(): bool;
    public function comparePairResults(array $results1, array $results2): array;
}
```

---

## ü§ñ –ü—Ä–∞–≤–∏–ª–∞ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ò–ò

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞

```php
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
declare(strict_types=1);           // –í—Å–µ–≥–¥–∞ –≤ –Ω–∞—á–∞–ª–µ
namespace PsyTest\Modules\Name;    // –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
use PsyTest\Core\Database;         // –ò–º–ø–æ—Ä—Ç—ã –ø–æ—Å–ª–µ namespace

class ClassName                  // PascalCase –¥–ª—è –∫–ª–∞—Å—Å–æ–≤
{
    private Type $property;      // –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
    
    public function methodName(  // camelCase –¥–ª—è –º–µ—Ç–æ–¥–æ–≤
        Type $param1,
        Type $param2
    ): ReturnType {              // ReturnType –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
        // ...
    }
}

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
// –ù–µ—Ç declare(strict_types=1)
// –ù–µ—Ç —Ç–∏–ø–∏–∑–∞—Ü–∏–∏
// –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π namespace
```

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```php
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
try {
    $result = $this->db->selectOne($sql, $params);
    if (!$result) {
        return null; // –Ø–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    }
    return $result;
} catch (\PDOException $e) {
    error_log("Database error: " . $e->getMessage());
    throw $e; // –ò–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º null
}

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
// –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
// –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–∞ null
```

### 3. –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

```php
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å prepared statements
$sql = "SELECT * FROM table WHERE id = :id";
$row = $db->selectOne($sql, ['id' => $id]);

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
if (!$row) {
    return null;
}

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
// –ü—Ä—è–º–∞—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ (SQL injection!)
$sql = "SELECT * FROM table WHERE id = $id";
```

### 4. Twig —à–∞–±–ª–æ–Ω—ã

```twig
{# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: #}
{# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π #}
{% if variable is defined and variable %}
    {{ variable|e }}  {# –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ #}
{% endif %}

{# –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π HTML #}
{{ html_content|raw }}  {# –¢–æ–ª—å–∫–æ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç #}

{# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: #}
{{ variable }}  {# –ë–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ #}
{{ user_input|raw }}  {# –û–ø–∞—Å–Ω–æ! #}
```

### 5. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

```php
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
// CSRF –ø—Ä–æ–≤–µ—Ä–∫–∞
Security::requireCsrf($_POST['csrf_token'] ?? null);

// –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–≤–æ–¥–∞
echo Security::h($userInput);

// –í–∞–ª–∏–¥–∞—Ü–∏—è email
if (!Security::isValidEmail($email)) {
    throw new InvalidArgumentException('Invalid email');
}

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
// –ü—Ä—è–º–æ–π –≤—ã–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
echo $_POST['input'];  {# XSS —É—è–∑–≤–∏–º–æ—Å—Ç—å #}
```

### 6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```php
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
use Monolog\Logger;

$logger = LoggerFactory::getLogger('module');
$logger->info('Action completed', ['data' => $data]);
$logger->error('Error occurred', ['error' => $e->getMessage()]);

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
echo "Debug: $value";  // –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
error_log($sensitiveData);  // –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```

### 7. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (–ú–æ–¥—É–ª—å vs –®–∞–±–ª–æ–Ω)

**–í–ê–ñ–ù–û–ï –ü–†–ê–í–ò–õ–û:** –ù–µ –¥—É–±–ª–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ç–µ–Ω—Ç –º–µ–∂–¥—É –º–æ–¥—É–ª–µ–º –∏ —à–∞–±–ª–æ–Ω–æ–º!

#### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:

**–ú–æ–¥—É–ª—å —Ç–µ—Å—Ç–∞** (`renderResults()`):
```php
public function renderResults(array $results): string
{
    $html = '<div class="test-results">';
    
    // –†–µ–Ω–¥–µ—Ä–∏—Ç –¢–û–õ–¨–ö–û —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π –¥–ª—è —Ç–µ—Å—Ç–∞ –∫–æ–Ω—Ç–µ–Ω—Ç:
    $html .= $this->renderScoreCard($results);        // –ö–∞—Ä—Ç–æ—á–∫–∞ –±–∞–ª–ª–æ–≤
    $html .= $this->renderScaleChart($results);       // –ì—Ä–∞—Ñ–∏–∫ —à–∫–∞–ª
    $html .= $this->renderSymptomList($results);      // –°–∏–º–ø—Ç–æ–º—ã
    $html .= $this->renderInterpretation($results);   // –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ç–µ—Å—Ç–∞
    $html .= $this->renderRecommendations($results);  // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    
    // –ù–ï –¥–æ–±–∞–≤–ª—è–µ—Ç –æ–±—â–∏–π –¥–∏—Å–∫–ª–µ–π–º–µ—Ä!
    $html .= '</div>';
    
    return $html;
}
```

**–®–∞–±–ª–æ–Ω** (`result-page.twig`):
```twig
<!-- Results Content -->
<div class="results-content">
    {{ results_html|raw }}  {# –ö–æ–Ω—Ç–µ–Ω—Ç –∏–∑ –º–æ–¥—É–ª—è #}
</div>

<!-- Disclaimer -->
<div class="results-disclaimer">
    <p>‚ö†Ô∏è –í–∞–∂–Ω–æ: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ—Å—è—Ç –æ–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä...</p>
</div>
```

#### ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:

**–ú–æ–¥—É–ª—å —Ç–µ—Å—Ç–∞:**
```php
// –ù–ï –î–ï–õ–ê–ô–¢–ï –¢–ê–ö:
$html .= '<div class="disclaimer">';
$html .= '<p>‚ö†Ô∏è –í–∞–∂–Ω–æ: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...</p>';
$html .= '</div>';
```

**–®–∞–±–ª–æ–Ω:**
```twig
<!-- –ù–ï –î–ï–õ–ê–ô–¢–ï –¢–ê–ö: -->
{% if interpretation %}
<div class="interpretation-block">
    <h2>–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è</h2>
    {{ interpretation.summary }}  {# –î—É–±–ª–∏—Ä—É–µ—Ç —Ç–æ, —á—Ç–æ —É–∂–µ –µ—Å—Ç—å –≤ results_html #}
</div>
{% endif %}
```

#### –ü—Ä–∏–Ω—Ü–∏–ø –µ–¥–∏–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞:

| –ö–æ–Ω—Ç–µ–Ω—Ç | –ì–¥–µ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å | –ü–æ—á–µ–º—É |
|---------|--------------|--------|
| –ë–∞–ª–ª—ã —Ç–µ—Å—Ç–∞ | –ú–æ–¥—É–ª—å | –°–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∞ |
| –ì—Ä–∞—Ñ–∏–∫–∏/—à–∫–∞–ª—ã | –ú–æ–¥—É–ª—å | –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞ |
| –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è | –ú–æ–¥—É–ª—å | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ç–µ—Å—Ç–∞ |
| –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ | –ú–æ–¥—É–ª—å | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∞ |
| **–û–±—â–∏–π –¥–∏—Å–∫–ª–µ–π–º–µ—Ä** | **–®–∞–±–ª–æ–Ω** | **–û–¥–∏–Ω–∞–∫–æ–≤—ã–π –¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤** |
| **–ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π** | **–®–∞–±–ª–æ–Ω** | **UI, –Ω–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞** |
| **–•–µ–¥–µ—Ä/—Ñ—É—Ç–µ—Ä** | **–®–∞–±–ª–æ–Ω** | **–û–±—â–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞** |

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ:

–ü–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–æ–¥–∞ –∑–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å:
- **"–≠—Ç–æ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –æ–¥–∏–Ω–∞–∫–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤?"**
  - ‚úÖ –î–∞ ‚Üí –î–æ–±–∞–≤—å—Ç–µ –≤ **—à–∞–±–ª–æ–Ω** (`result-page.twig`)
  - ‚ùå –ù–µ—Ç ‚Üí –î–æ–±–∞–≤—å—Ç–µ –≤ **–º–æ–¥—É–ª—å** (`renderResults()`)

---

## üîß –ß–∞—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

### –ó–∞–¥–∞—á–∞ 1: –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å –≤ —Ç–µ—Å—Ç

**–§–∞–π–ª:** `modules/{test}/questions.json`

```json
{
  "id": 51,
  "text": "–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞",
  "scale": "SCALE_NAME",
  "direction": "direct"
}
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ metadata.json:**
```json
{
  "question_count": 51
}
```

### –ó–∞–¥–∞—á–∞ 2: –ò–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–¥—Å—á—ë—Ç–∞

**–§–∞–π–ª:** `modules/{test}/{Test}Module.php`

```php
public function calculateResults(array $answers): array
{
    // –ò–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –∑–¥–µ—Å—å
    // –í–µ—Ä–Ω—É—Ç—å –º–∞—Å—Å–∏–≤ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
}
```

### –ó–∞–¥–∞—á–∞ 3: –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —à–∞–±–ª–æ–Ω

**–§–∞–π–ª:** `templates/new-template.twig`

```twig
{% extends "layout.twig" %}

{% block title %}–ó–∞–≥–æ–ª–æ–≤–æ–∫{% endblock %}

{% block content %}
    <div class="content">
        {{ variable }}
    </div>
{% endblock %}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ:**
```php
echo $this->view->render('new-template', [
    'variable' => 'value',
]);
```

### –ó–∞–¥–∞—á–∞ 4: –î–æ–±–∞–≤–∏—Ç—å API endpoint

**–§–∞–π–ª:** `public/index.php`

```php
$router->get('/api/test/{slug}', [ApiController::class, 'testInfo']);
```

**–§–∞–π–ª:** `controllers/ApiController.php`

```php
public function testInfo(string $slug): array
{
    $module = $this->moduleLoader->getModule($slug);
    return [
        'success' => true,
        'data' => $module->getMetadata(),
    ];
}
```

### –ó–∞–¥–∞—á–∞ 5: –†–∞–±–æ—Ç–∞ —Å —Å–µ—Å—Å–∏—è–º–∏

```php
// –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é
$session = $sessionManager->createSession($testId);

// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
$sessionManager->saveAnswers($sessionId, $answers);

// –ó–∞–≤–µ—Ä—à–∏—Ç—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
$sessionManager->completeSession($sessionId, $results);

// –ü–æ–ª—É—á–∏—Ç—å –ø–æ —Ç–æ–∫–µ–Ω—É (–¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
$session = $sessionManager->getSessionByToken($token);

// –£–¥–∞–ª–∏—Ç—å (GDPR)
$sessionManager->deleteSession($sessionId);
```

### –ó–∞–¥–∞—á–∞ 6: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF

```php
$pdfGenerator = new PDFGenerator();

// –¢–µ—Å—Ç–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
$pdfPath = $pdfGenerator->generateTestResult($session, $test, $html);

// AI –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è
$pdfPath = $pdfGenerator->generateAIInterpretation($session, $test, $text);

// –û—Ç–¥–∞—á–∞ —Ñ–∞–π–ª–∞
header('Content-Type: application/pdf');
readfile(__DIR__ . '/../' . $pdfPath);
```

### –ó–∞–¥–∞—á–∞ 7: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI (OpenRouter)

```php
$aiService = new AIInterpretationService();

$result = $aiService->generateInterpretation($session, $test);

// $result['text'] - —Ç–µ–∫—Å—Ç –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏
// $result['pdf_path'] - –ø—É—Ç—å –∫ PDF
```

### –ó–∞–¥–∞—á–∞ 8: –ü–ª–∞—Ç–µ–∂–∏ (–ÆMoney)

```php
$paymentService = new PaymentService();

// –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
$payment = $paymentService->createPayment($session, 499);

// –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ–ø–ª–∞—Ç—É
header('Location: ' . $payment['payment_url']);

// Webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ ApiController::yoomoneyWebhook()
```

---

## üìù –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞

- [ ] –°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ `modules/{test-name}/`
- [ ] –°–æ–∑–¥–∞–Ω `{TestName}Module.php` —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- [ ] –°–æ–∑–¥–∞–Ω `metadata.json` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
- [ ] –°–æ–∑–¥–∞–Ω `questions.json` —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –ú–æ–¥—É–ª—å —Ä–∞—Å—à–∏—Ä—è–µ—Ç `BaseTestModule`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å–µ –º–µ—Ç–æ–¥—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É `tests`
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ `test-architecture.php`
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è

---

## üÜò –û—Ç–ª–∞–¥–∫–∞

### –í–∫–ª—é—á–∏—Ç—å debug —Ä–µ–∂–∏–º

**.env:**
```env
APP_DEBUG=true
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
tail -f storage/logs/app.log
tail -f storage/logs/server.log
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```bash
php test-architecture.php
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª—è

```bash
php -r "
require 'vendor/autoload.php';
\$module = new PsyTest\Modules\Smil\SmilModule();
print_r(\$module->getMetadata());
\$results = \$module->calculateResults([1 => true, 2 => false]);
print_r(\$results);
"
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ò–ò

–ü—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Å –ø–æ–º–æ—â—å—é –ò–ò:

1. **–í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç:**
   - "–Ø —Ä–∞–±–æ—Ç–∞—é –≤ –ø—Ä–æ–µ–∫—Ç–µ PsyTest Platform"
   - "–ò—Å–ø–æ–ª—å–∑—É—é PHP 8.5, Twig 3, MySQL 9"
   - "–°–ª–µ–¥—É—é PSR-4 –∏ PSR-12"

2. **–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–π—Ç–µ –ø—Ä–∏–º–µ—Ä—ã:**
   - "–ö–∞–∫ SmilModule —Ä–µ–∞–ª–∏–∑—É–µ—Ç calculateResults"
   - "–ö–∞–∫ HomeController –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ModuleLoader"

3. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ `test-architecture.php`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
   - –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏

4. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
   - –ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ
   - –ö–∞–∫–∏–µ —Ñ–∞–π–ª—ã –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã
   - –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** 1.0  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-02-25
