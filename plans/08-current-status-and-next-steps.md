# –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∏ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

**–î–∞—Ç–∞:** 27 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–í–µ—Ç–∫–∞:** `refactor/technical-debt-phase1`  
**–°—Ç–∞—Ç—É—Å:** Code Review –∑–∞–≤–µ—Ä—à—ë–Ω, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ Phase 1

### 1. –ì–µ–Ω–¥–µ—Ä–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤–æ–ø—Ä–æ—Å–æ–≤ - 100% ‚úÖ
- ‚úÖ –°–æ–∑–¥–∞–Ω [`modules/smil/questions-566-gender.json`](../modules/smil/questions-566-gender.json)
- ‚úÖ 566 –≤–æ–ø—Ä–æ—Å–æ–≤ —Å –ø–æ–ª—è–º–∏ `text_male` –∏ `text_female`
- ‚úÖ –ú–µ—Ç–æ–¥ [`getQuestionsForGender()`](../modules/smil/SmilModule.php:236)
- ‚úÖ UI –≤—ã–±–æ—Ä–∞ –ø–æ–ª–∞ –≤ demographics section
- ‚úÖ JavaScript –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç ([`public/js/test-taking.js:186`](../public/js/test-taking.js:186))
- ‚úÖ Data-–∞—Ç—Ä–∏–±—É—Ç—ã –≤ —à–∞–±–ª–æ–Ω–µ ([`templates/test-wrapper.twig:79-80`](../templates/test-wrapper.twig:79))

### 2. –®–∫–∞–ª–∞ "?" (–Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã) - 100% ‚úÖ
- ‚úÖ UI –∫–Ω–æ–ø–∫–∞ "–ù–µ –∑–Ω–∞—é" ([`templates/test-wrapper.twig:99-102`](../templates/test-wrapper.twig:99))
- ‚úÖ –ú–µ—Ç–æ–¥ [`calculateUnknownScale()`](../modules/smil/SmilModule.php:529)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ [`assessValidity()`](../modules/smil/SmilModule.php:714)
- ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ –°–æ–±—á–∏–∫: 40/60/70 –±–∞–ª–ª–æ–≤
- ‚úÖ –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `ANSWER_UNKNOWN = 2` ([`SmilModule.php:46`](../modules/smil/SmilModule.php:46))

### 3. –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã - 50% ‚ö†Ô∏è
- ‚úÖ 27 –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–º–µ—á–µ–Ω—ã –≤ JSON (`is_control: true`)
- ‚úÖ –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ README ([`modules/smil/README.md:61`](../modules/smil/README.md:61))
- ‚ùå **–ù–ï –°–î–ï–õ–ê–ù–û:** –ú–µ—Ç–æ–¥ `calculateControlScale()`
- ‚ùå **–ù–ï –°–î–ï–õ–ê–ù–û:** –í–∞–ª–∏–¥–∞—Ü–∏—è QC < 20 = –Ω–µ–¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ

### 4. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è - 100% ‚úÖ
- ‚úÖ –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏–π –æ—Ç–≤–µ—Ç–æ–≤ (ANSWER_YES, ANSWER_NO, ANSWER_UNKNOWN)
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ `assessValidity()` - –º–µ—Ç–æ–¥ —Å–∞–º –≤—ã—á–∏—Å–ª—è–µ—Ç unknownCount
- ‚úÖ –£–ø—Ä–æ—â—ë–Ω fallback –≤ —à–∞–±–ª–æ–Ω–µ (null coalescing –æ–ø–µ—Ä–∞—Ç–æ—Ä)
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### 5. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è - 100% ‚úÖ
- ‚úÖ 4 Python —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ PDF
- ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç [`bin/create-full-smil-session.php`](../bin/create-full-smil-session.php)
- ‚úÖ 6 markdown –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –∞–Ω–∞–ª–∏–∑–æ–º –∏ –ø–ª–∞–Ω–∞–º–∏
- ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω [`plans/00-executive-summary.md`](00-executive-summary.md)

---

## ‚ùå –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —à–∫–∞–ª–∞ QC üî¥

**–ü—Ä–æ–±–ª–µ–º–∞:** 27 –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–º–µ—á–µ–Ω—ã, –Ω–æ –Ω–µ –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è.

**–ó–∞–¥–∞—á–∏:**
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `calculateControlScale()` –≤ [`SmilModule.php`](../modules/smil/SmilModule.php)
2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `assessValidity()`
3. –î–æ–±–∞–≤–∏—Ç—å –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã `validity['control_score']`

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏:**
- < 20 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –∏–∑ 27 = –ø—Ä–æ—Ç–æ–∫–æ–ª –Ω–µ–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω

**–ö–æ–¥:**
```php
/**
 * Calculate control questions scale (QC)
 * 
 * 27 control questions with instruction "–û–±–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–∞–Ω–Ω–æ–≥–æ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∫—Ä—É–∂–æ—á–∫–æ–º"
 * Correct answer: "–î–∞" (1)
 * 
 * @param array $answers User answers
 * @return int Count of correct answers (0-27)
 */
protected function calculateControlScale(array $answers): int
{
    $controlQuestions = [
        14, 33, 48, 63, 66, 69, 121, 123, 133, 151, 
        168, 182, 184, 197, 200, 205, 266, 275, 293, 
        334, 349, 350, 462, 464, 474, 542, 551
    ];
    
    $correctCount = 0;
    foreach ($controlQuestions as $qNum) {
        // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å - "–î–∞" (1)
        if (isset($answers[$qNum]) && $answers[$qNum] == self::ANSWER_YES) {
            $correctCount++;
        }
    }
    
    return $correctCount;
}
```

**–û–±–Ω–æ–≤–∏—Ç—å `assessValidity()`:**
```php
// Calculate control scale
$controlScore = $this->calculateControlScale($answers);

// Check control scale
if ($controlScore < 20) {
    $valid = false;
    $warnings[] = "–ü—Ä–æ—Ç–æ–∫–æ–ª –Ω–µ–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω: –Ω–∏–∑–∫–∞—è –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (QC = {$controlScore} < 20)";
}

// Add to results
return [
    'valid' => $valid,
    'warnings' => $warnings,
    'L_score' => $L,
    'F_score' => $F,
    'K_score' => $K,
    'FK_index' => $fkIndex,
    'unknown_count' => $unknownCount,
    'control_score' => $controlScore,  // NEW
];
```

---

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –°–≤–µ—Ä–∫–∞ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö üü°

**–§–∞–π–ª:** [`modules/smil/basic_scales_norms.json`](../modules/smil/basic_scales_norms.json)

**–ó–∞–¥–∞—á–∏:**
1. –ò–∑–≤–ª–µ—á—å —Ç–∞–±–ª–∏—Ü—ã –Ω–æ—Ä–º –∏–∑ [`source/metod/sob-01.pdf`](../source/metod/sob-01.pdf) (—Å—Ç—Ä. 45-50)
2. –°—Ä–∞–≤–Ω–∏—Ç—å —Å —Ç–µ–∫—É—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ M –∏ œÉ
3. –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º—É–ª—ã K-–∫–æ—Ä—Ä–µ–∫—Ü–∏–∏

**–≠—Ç–∞–ª–æ–Ω–Ω—ã–µ –Ω–æ—Ä–º—ã (–∏–∑ sob-01.pdf):**

| –®–∫–∞–ª–∞ | –ú—É–∂—á–∏–Ω—ã M/œÉ | –ñ–µ–Ω—â–∏–Ω—ã M/œÉ |
|-------|-------------|-------------|
| L | 4.2 / 2.9 | 4.2 / 2.9 |
| F | 2.76 / 4.67 | 2.76 / 4.67 |
| K | 12.1 / 5.4 | 12.1 / 5.4 |
| 1 | 11.1 / 3.9 | 12.9 / 4.83 |
| 2 | 16.6 / 4.11 | 18.9 / 5.0 |
| 3 | 16.46 / 5.4 | 18.66 / 5.38 |
| 4 | 18.68 / 4.11 | 18.68 / 4.11 |
| 5 | 20.46 / 5.03 | 36.7 / 4.67 |
| 6 | 7.9 / 3.4 | 7.9 / 3.4 |
| 7 | 23.06 / 5.02 | 25.07 / 6.1 |
| 8 | 21.96 / 5.0 | 22.73 / 6.36 |
| 9 | 17.0 / 4.06 | 17.0 / 4.06 |
| 0 | 25.0 / 10.0 | 25.0 / 10.0 |

---

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: Unit-—Ç–µ—Å—Ç—ã üü¢

**–ó–∞–¥–∞—á–∏:**
1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è `calculateUnknownScale()`
2. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è `calculateControlScale()`
3. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è `getQuestionsForGender()`
4. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è `assessValidity()`

**–§–∞–π–ª:** `tests/SmilModuleTest.php`

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –í–∞—Ä–∏–∞–Ω—Ç A: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (1 –¥–µ–Ω—å)
1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `calculateControlScale()`
2. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å `assessValidity()`
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å `--all-true` –∏ `--random`

### –í–∞—Ä–∏–∞–Ω—Ç B: –ü–æ–ª–Ω—ã–π (2-3 –¥–Ω—è)
1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `calculateControlScale()`
2. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å `assessValidity()`
3. ‚úÖ –°–≤–µ—Ä–∏—Ç—å –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å sob-01.pdf
4. ‚úÖ –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã
5. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

## üìã –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
# –°–ª—É—á–∞–π–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
php bin/create-full-smil-session.php --random --gender=male

# –í—Å–µ "–í–µ—Ä–Ω–æ" (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —à–∫–∞–ª—ã)
php bin/create-full-smil-session.php --all-true --gender=male

# –í—Å–µ "–ù–µ –∑–Ω–∞—é" (–ø—Ä–æ–≤–µ—Ä–∫–∞ —à–∫–∞–ª—ã "?")
php bin/create-full-smil-session.php --all-unknown --gender=female

# –ü–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–Ω—ã—Ö —à–∫–∞–ª
php bin/create-full-smil-session.php --pattern --gender=male
```

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

| –†–µ–∂–∏–º | –®–∫–∞–ª–∞ "?" | –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è QC | –í–∞–ª–∏–¥–Ω–æ—Å—Ç—å |
|-------|-----------|----------------|------------|
| --all-true | 0 | 27 | ‚úÖ –í–∞–ª–∏–¥–Ω–æ |
| --all-false | 0 | 0 | ‚ùå QC < 20 |
| --all-unknown | 566 | 0 | ‚ùå ? > 70 |
| --random | ~188 | ~9 | ‚ö†Ô∏è –ó–∞–≤–∏—Å–∏—Ç |

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞—á–∞—Ç—å —Å **–í–∞—Ä–∏–∞–Ω—Ç–∞ A** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —à–∫–∞–ª—É QC.

–≠—Ç–æ –∑–∞–∫—Ä–æ–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–±–µ–ª –≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–µ—Å—Ç–∞ –ø–æ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ –°–æ–±—á–∏–∫.
